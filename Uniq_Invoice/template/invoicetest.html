{% extends 'base.html' %}
{% load static %}
{% block content %}

 


<div class="main-content">
    <div class="page-content">
      <div class="container-fluid">
        <div class="row">
          <div class="col-12">
            <div class="page-title-box d-sm-flex align-items-center justify-content-between">
              <h4 class="mb-sm-0">Invoice</h4>
              <div class="page-title-right">
                <ol class="breadcrumb m-0">
                  <li class="breadcrumb-item">
                    <a href="javascript: void(0);">Dashboard </a>
                  </li>
                  <li class="breadcrumb-item active">Transaction</li>
                  <li class="breadcrumb-item active">Invoice</li>
                </ol>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col">
            <div class="h-100">
              <div class="row mb-3 pb-1">
                <div class="col-12">
                  <div class="d-flex align-items-lg-center flex-lg-row flex-column"></div>
                </div>
                <!--end col-->
              </div>
              <div class="row">
                <div class="col">
                  <div class="h-100">
                    <div class="row mb-3 pb-1">
                      <div class="col-12">
                        <div class="d-flex align-items-lg-center flex-lg-row flex-column"></div>
                      </div>
                    </div>
                    <form method="POST" action="/invoice_file/" onsubmit="return validateForm()" name="myform"> 
                      {% csrf_token %} 
                      <div class="row">
                        <div class="col-lg-10 offset-1 ">
                          <div class="card" style="padding:25px;">
                            <div class="card-header align-items-center d-flex">
                              <h1 class="card-title mb-0 flex-grow-1">
                                <center>INVOICE</center>

                              </h1>
                            </div>
                            <div class="card-body">
                              <div class="live-preview">
                                <div class="row gy-4">
                                  <div class="col-xxl-12 col-md-6">
                                    <div>
                                      <label for="exampleInputrounded" class="form-label"> Invoice Number : </label>
                                      <input type="text" class="form-control rounded-pill" name="Invoice_Number" value="{{Invoice_no}}">
                                    </div>
                                  </div>
                                  <div class="col-xxl-6 col-md-6">
                                    <div>
                                      <label for="exampleInputrounded" class="form-label"> Invoice Date : </label>
                                      <input type="date" class="form-control rounded-pill" id="date" name="invoice_date">
                                    </div>
                                  </div>
                                  <div class="col-xxl-6 col-md-6">
                                    <div>
                                      <label for="exampleInputrounded" class="form-label">Invoice Due Date : </label>
                                      <input type="date" class="form-control rounded-pill" name="Invoice_Due_Date" value="{{Due_Date}}" id="invoice_duedate">
                                    </div>
                                  </div>
                                  <div class="col-xxl-6 col-md-6">
                                    <div id="po">
                                      <label for="exampleInputrounded" class="form-label  required">Po Number : </label>
                                      <input type="text" class="form-control rounded-pill" name="invoice_po">
                                      <span id="wname1" class="formerror"></span>
                                    </div>
                                  </div>
                                  <div class="col-xxl-6 col-md-6">
                                    <div>
                                      <label for="exampleInputrounded" class="form-label">Dealer/Customer : </label>
                                      <select name="dealer" id="dealerinfo" class="form-control rounded-pill">
                                         {% for x in alldealer %} 
                                         <option value="{{x.id}}"> <b> {{x}}</b>  </option>
                                        {% endfor %} 
                                      </select>
                                    </div>
                                  </div>
                                  <br>
                                  <br>
                                  
                                  <div class="col-xxl-6 col-md-3">
                                    <div>
                                      <label for="exampleInputrounded" class="form-label">Invoice Type :</label>&nbsp;&nbsp; <input type="checkbox" name="Invoice_Type">
                                      <label>Actual Invoice</label>
                                    </div>
                                  </div>
                                  <div class="col-xxl-6 col-md-3">
                                    <div>
                                  
                                    </div>
                                  </div>


                                  
                                  <div class="col-xxl-6 col-md-6">
                                    <div> {% for i in c_id %} <p>
                                        <b>Company Name : </b>{{i.Company_Name}}
                                      </p>
                                      <p>
                                        <b>Owner Name : </b>{{i.Owner_name}}
                                      </p>
                                      <p>
                                        <b>Address : </b>{{i.Address}}
                                      </p>
                                      <p>
                                        <b>Email : </b>{{i.Email_Address}}
                                      </p>
                                      <p>
                                        <b>Phone No : </b>{{i.Phone_Number}}
                                      </p>
                                      <p>
                                        <b>GST NO. : </b>{{i.GST_Number}}
                                      </p>
                                      <p>
                                        <b>Office NO. : </b>{{i.Office_Number}}
                                      </p> {% endfor %}
                                    </div>
                                  </div>

                                  <div class="col-xxl-6 col-md-6">
                                    <div id="viewdealer"></div>
                                  </div>
                                </div>
                                  <style>
                                    table,
                                    th,
                                    td {
                                      border: 1px solid black;
                                    }
                                  </style>
                                  
                                

                                  <div class="container">
                                  
                                            <div class="col-xxl-3 col-md-2">
                                              <div class="input-group" >
                                              
                                                  <label class="input-group-text" for="inputGroupSelect01" >Select Item </label>
                                                  <select class="form-select" name="selecteditem" id="ddlitemmaster"     id="inputGroupSelect01">
                                                    {% comment %} <option selected="">Choose...</option> {% endcomment %}
                                                      {% for i in  allitem %}

                                                      <option value='{{i.id}}' >{{i.item_name}}</option>
                                                      
                                                      {% endfor %}
                                                      
                                                  </select>
                                                  &nbsp;&nbsp;
                                                  <input id="addBtn"  class="btn btn-primary" type="button" value="Add"/>
                                              
                                              </div>
                                          </div>
                                         
                                   
                                    <br>
                                    {% comment %} <div class="col-xxl-6 col-md-3">
                                      <label><B>select A value to Add new Row </B></label>
                                      <SELECT style="width: 150px;" class="form-control" id="ddlitemmaster" name="selecteditem" >
                                         {% for x in allitem %}
                                          <option value='{{x.id}}'><b>{{x.item_name}}</b> </option>
                                        {% endfor %} 
                                      </SELECT>&nbsp;
                                    </div> {% endcomment %}
                                    <div class="row clearfix">
                                    
                                      <div class="col-md-12">
                                        <table class="table table-bordered table-hover" name="tab_table" id="tab_logic">
                                          <thead>
                                            <tr>
                                              <th ># </th>
                                              <th class="text-center"> Item Name </th>
                                              <th class="text-center"> Item Description </th>
                                              <th class="text-center"> Model Name </th>
                                              <th class="text-center"> Ampear </th>
                                              <th class="text-center"> Avilable Qty </th>
                                              <th class="text-center"> Qty </th>
                                              <th class="text-center"> Price </th>
                                              <th class="text-center"> Total </th>
                                              <th class="text-center"> Delete </th>
                                            </tr>
                                          </thead>
                                          <tbody id="tbody" name="tablebody" >

                                           
                                          </tbody>
                                        </table>
                                      </div>
                                    </div>
                                    {% comment %} <div class="row clearfix">
                                      <div class="col-md-12">
                                        <button id="add_row" class="btn btn-default pull-left">Add Row</button>
                                        <button id='delete_row' class="pull-right btn btn-default">Delete Row</button>
                                      </div>
                                    </div> {% endcomment %}
                                    <div class="row clearfix" style="margin-top:20px;float:right;">
                                      <div class="pull-right col-md-12" width="100%">
                                        <table class="table table-bordered table-hover"  id="tab_logic_total">
                                          <tbody>
                                            <tr>
                                              <th class="text-center">Sub Total</th>
                                              <td class="text-center">
                                                <input type="number" name='sub_total' placeholder='0' class="form-control" id="sub_total" readonly />
                                              </td>
                                            </tr>
                                            <tr>
                                              <th class="text-center">Tax</th>
                                              <td class="text-center">
                                                <div class="input-group mb-2 mb-sm-0">
                                                  <input type="number" name="tax" class="form-control" id="tax" value='9' placeholder="0">
                                                  <div class="input-group-addon">%</div>
                                                </div>
                                              </td>
                                            </tr>
                                            <tr>
                                              <th class="text-center">Tax Amount</th>
                                              <td class="text-center">
                                                <input type="number" name='tax_amount'  id="tax_amount" placeholder='0' class="form-control" readonly />
                                              </td>
                                            </tr>
                                            <tr>
                                              <th class="text-center">Grand Total</th>
                                              <td class="text-center">
                                                <input type="number" name='total_amount' id="total_amount" placeholder='0' class="form-control" readonly />
                                              </td>
                                            </tr>
                                            {% comment %} <tr>
                                              <th class="text-center">Recived Amount</th>
                                              <td class="text-center">
                                                <input type="number" name='recived_amount' id="recived_amount" placeholder='0.00' class="form-control"  />
                                              </td>
                                            </tr>
                                            <tr>
                                              <th class="text-center">Due Amount</th>
                                              <td class="text-center">
                                                <input type="number" name='due_amount' id="due_amount" placeholder='0.00' class="form-control" readonly />
                                              </td>
                                            </tr> {% endcomment %}
                                          </tbody>
                                        </table>
                                      </div>
                                    </div>
                                  </div>
                                  <div>
                                   
                                  </div>
                                </div>
                             
                              </div>
                              <div class="col gy-4"  >
                                  <button type="submit" class="btn btn-primary" style="width: 70px;">Save</button>
                                <a href="#">
                                  <button type="type" class="btn btn-primary" style="width: 90px;">Preview</button>
                                </a>
                                <a href="{% url 'ItemMaster:Invoice_view' %}">
                                   <button type="button" class="btn btn-danger" style="width: 90px;">Cancle</button>
                                </a>
                            
                            </div>
                             
                            
                            </div>
                          </div>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

        <script
            src="http://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
            crossorigin="anonymous">
        </script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment-with-locales.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.4/js/select2.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment-with-locales.min.js"></script>

        {% comment %} <script>

          function multiply()
          {
              // Get the input values
              a = Number(document.getElementById('QTY').value);
              b = Number(document.getElementById('PPRICE').value);
              d=  Number(document.getElementById('tax').value);
              // Do the multiplication
              c = a*b;
              e=d/100*c;
              g=c+e;
              // Set the value of the total
              document.getElementById('TOTAL').value=c;
              document.getElementById('sub_total').value=c;
              document.getElementById('tax_amount').value=e;
              document.getElementById('total_amount').value=g;
          }
              
          
       
      </script> {% endcomment %}



        <script>
            $("#dealerinfo").change(function () {
                const dealinfo = $(this).val();  // get the selected subject ID from the HTML dropdown list 
                      console.log(dealinfo)
                $.ajax({                       // initialize an AJAX request
                    type: "POST",
                    url: '/get_dealer_ajax/',
                    data: {
                        'dealer_id': dealinfo,       // add the country id to the POST parameters
                        'csrfmiddlewaretoken':$('input[name=csrfmiddlewaretoken]').val(),
                    },
                    success: function (response) {   // `data` is from `get_topics_ajax` view function
                       // replace the contents of the topic input with the data that came from the server
                        data=response.dealer_data
                        $("#viewdealer").empty();
                        $("#viewdealer").append();

                        
                            var mainContainer = document.getElementById("viewdealer");
                            console.log(mainContainer);
                            for (var i = 0; i < data.length; i++) {
                              var div = document.createElement("div");
                            
                              console.log(data[0].id);
                              div.innerHTML = "<b>" + 'Dealer Company Name  : '+ "</b>"   + data[0].dealer_company_name + "<br/>" + "<br/>" 
                          
                                            +"<b>" + 'Dealer Name :    ' + "</b>" + data[i].dealre_name + "<br/>" + "<br/>" 
                                            +"<b>" + 'Dealer Address : ' +"</b>" + data[i].dealer_address + "<br/>" + "<br/>" 
                                            +"<b>" + 'Dealer Email :   ' +"</b>" + data[i].dealer_email_address  + "<br/>"+ "<br/>" 
                                            +"<b>" + 'Dealer Mobile NO. :  ' +"</b>" + data[i].dealer_phone_number + "<br/>"+ "<br/>" 
                                            +"<b>" + 'Dealer GST Number :  ' +"</b>" + data[i].gst_number+ "<br/>"+ "<br/>" 
                                            +"<b>" + 'Dealer Office NO. :  ' +"</b>" + data[i].dealer_office_number;


                              mainContainer.appendChild(div);
                            }
                          

                    }
                                
              
                });
            });
        
        </script>

        <script>
            $('#date').val(new Date().toJSON().slice(0,10));
        </script>

        <script>
            $("#ddlitemmaster").change(function () {
                output="";
                const itemId= $(this).val();  // get the selected subject ID from the HTML dropdown list 
                
                $.ajax({                       // initialize an AJAX request
                    method: "POST",
                    url: '/get_items_ajax/',
                    data: {
                        'item_id': itemId,       // add the country id to the POST parameters
                        'csrfmiddlewaretoken':$('input[name=csrfmiddlewaretoken]').val(),
                    },
                              success: function (response) {   // `data` is from `get_topics_ajax` view function
                                // replace the contents of the topic input with the data that came from the server
                                
                                  x=response.item_data
                                //  console.log(x);
                                   for (i = 0; i<x.length; i++) {
                                          
                                      output+="<tr><td><input type='hidden' name='id' id='id'  value='"+x[i].id+"' class='form-control />'+'</td><td><input type='text' name='Itemname'   value='"+x[i].item_name+"' class='form-control />'+'</td><td><input type='text' name='Itmdes'  value='"+x[i].item_description+"' class='form-control />'+'</td><td><input type='text' name='modelname'  value='"+x[i].model_name+"' class='form-control />'+'</td><td><input type='text' name='ampear'  value='"+x[i].Ampear+"' class='form-control />'+'</td><td><input type='text' name='item_Qty'  value="+x[i].Quantity+" class='form-control avl'  readonly /></td><td><input type='number' name='qty[]' placeholder='Enter Qty' id = 'quantity'   onchange='calc()' value='1'  class='form-control qty'  /></td><td><input type='text' name='price[]' id='item_price'  value="+x[i].DP_price+"  class='form-control price' disabled /></td><td><input type='number' name='total[]'  value="+x[i].DP_price+"  id='total_price' class='form-control total' readonly /></td><td align='center'><i class='fa fa-trash-o' id='del_row' aria-hidden='true' onclick='deleteRow(this)' style='font-size:24px;color:red'></i></td> </tr>";
                                      additem();         
                                  }         
                                  
                                }
                                
                            });
                        });
        </script>
        
        


        <script>
          function additem(){
              var rowCount = $('#tab_logic tr').length;
              
              console.log(rowCount);
              // jQuery button click event to add a row
              $('#addBtn').on('click', function () {
                  $('#tbody').append(output);
                  calc();
                 // console.log(output)
                // Adding a row inside the tbody.
              
              });

              $("#addBtn").on('click', function(){
                var name = $(this).text();
               // console.log(name);
                if($("#" + name).length == 0) {
                  $('#tbody').append(output);
                } else {
                  alert('this record already exists');
                }
              });
         
          }
         
        </script>

       
        <script>
          function deleteRow(r) {
            var i = r.parentNode.parentNode.rowIndex;
            document.getElementById("tab_logic").deleteRow(i);
            calc();
          }
          </script>

      
   

   <script> 
      $(document).ready(function(){
        var i=1;
        $("#add_row").click(function(){b=i-1;
            $('#addr'+i).html($('#addr'+b).html()).find('td:first-child').html(i+1);
            $('#tab_logic').append('<tr id="addr'+(i+1)+'"></tr>');
            i++; 
        });
        $("#delete_row").click(function(){
          if(i>1){
        $("#addr"+(i-1)).html('');
        i--;
        }
        calc();
      });
      
      $('#tab_logic tbody').on('keyup change',function(){
        calc();
      });
      $('#tax').on('keyup change',function(){
        calc_total();
      });
      
    
    });
    
    
    function calc()
    {
      $('#tab_logic tbody tr').each(function(i, element) {
        var html = $(this).html();
        //console.log(html)
        if(html!='')
        {
          var qty = $(this).find('.qty').val();
          //console.log(qty)
         // var avlqty = $(this).find('.avl').val();
          //$(this).find('.avl').val(avlqty-qty);
          var price = $(this).find('.price').val();
          //console.log(price)
          $(this).find('.total').val(qty*price);
       
          
          calc_total();
         
        }
        });
    }
    
    function calc_total()
    {
      total=0;
      $('.total').each(function() {
            total += parseInt($(this).val());
           
        });
       // console.log(total)
      $('#sub_total').val(total);
      tax_sum=total/100*$('#tax').val();
      $('#tax_amount').val(tax_sum);
      $('#total_amount').val((tax_sum+total));
    
    }

    </script>

    <script>
      function clearErrors() {

          errors = document.getElementsByClassName('formerror');
          for (let item of errors) {
              item.innerHTML = "";
          }
  
  
      }
      function seterror(id, error) {
          //sets error inside tag of id 
          element = document.getElementById(id);
          console.log(element)

          element.getElementsByClassName('formerror')[0].innerHTML = error;
  
      }
      function validateForm() {
          var returnval = true;
          clearErrors();
        
          var iname = document.forms['myform']["invoice_po"].value;
          if (iname.length == "") {
              seterror("po", "This field is required");
              returnval = false;
          }
            
             
                
          return returnval;
      }
              
  </script> 
                                                     
 
   

{% endblock %}