{% extends 'base.html' %}
{% load static %}
{% block content %}

 


<div class="main-content">
    <div class="page-content">
      <div class="container-fluid">
        <div class="row">
          <div class="col-12">
            <div class="page-title-box d-sm-flex align-items-center justify-content-between">
              <h4 class="mb-sm-0">Invoice</h4>
              <div class="page-title-right">
                <ol class="breadcrumb m-0">
                  <li class="breadcrumb-item">
                    <a href="javascript: void(0);">Dashboard </a>
                  </li>
                  <li class="breadcrumb-item active">Transaction</li>
                  <li class="breadcrumb-item active">Invoice</li>
                </ol>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col">
            <div class="h-100">
              <div class="row mb-3 pb-1">
                <div class="col-12">
                  <div class="d-flex align-items-lg-center flex-lg-row flex-column"></div>
                </div>
                <!--end col-->
              </div>
              <div class="row">
                <div class="col">
                  <div class="h-100">
                    <div class="row mb-3 pb-1">
                      <div class="col-12">
                        <div class="d-flex align-items-lg-center flex-lg-row flex-column"></div>
                      </div>
                    </div>
                    <form method="POST" action="{% url 'ItemMaster:Invoice_Edit' inv_data.id %}" > 
                      {% csrf_token %} 
                      <div class="row">
                        <div class="col-lg-10 offset-1 ">
                          <div class="card" style="padding:25px;">
                            <div class="card-header align-items-center d-flex">
                              <h1 class="card-title mb-0 flex-grow-1">
                                <center>INVOICE EDIT</center>
                              </h1>
                            </div>
                            <div class="card-body">
                              <div class="live-preview">
                                <div class="row gy-4">
                                  <div class="col-xxl-12 col-md-6">
                                    <div>
                                      <label for="exampleInputrounded" class="form-label"> Invoice Number : </label>
                                      <input type="text" class="form-control rounded-pill" name="Invoice_Number" value="{{inv_data.InvoiceNo}}">
                                    </div>
                                  </div>
                                  <div class="col-xxl-6 col-md-6">
                                    <div>
                                      <label for="exampleInputrounded" class="form-label"> Invoice Date : </label>
                                      <input type="date" class="form-control rounded-pill" value={{invoice_date}} id="date" name="invoice_date">
                                    </div>
                                  </div>
                                  <div class="col-xxl-6 col-md-6">
                                    <div>
                                      <label for="exampleInputrounded" class="form-label">Invoice Due Date : </label>
                                      <input type="date" class="form-control rounded-pill"value={{invoice_Due_date}} name="Invoice_Due_Date"  id="invoice_duedate">
                                    </div>
                                  </div>
                                  <div class="col-xxl-6 col-md-6">
                                    <div>
                                      <label for="exampleInputrounded" class="form-label">PO : </label>
                                      <input type="text" class="form-control rounded-pill" value="{{inv_data.PoNumber}}" name="invoice_po">
                                    </div>
                                  </div>
                                  <div class="col-xxl-6 col-md-6">
                                    <div id="waer">
                                        <label for="exampleInputrounded" class="required">
                                             Dealer/Customer Details </label>
                                            <input type="text" class="form-control rounded-pill"  id="dealerinfo"  value="{{inv_data.DealerId.dealer_company_name}}"   name="dealer" placeholder="Choose Dealer/Customer "  list="warehousename" />
                                            <datalist  id="warehousename">
                                                <optgroup  label="warehousename">
                                                    {% for i in  Dealer_data %}

                                                    <option  >{{i.dealer_company_name}}</option>
                                                    
                                                    {% endfor %}
                                            </datalist>
                                           
                                    </div>
                                </div>
                                  <br>
                                  <br>
                                  
                                  <div class="col-xxl-6 col-md-3">
                                    <div>
                                      <label for="exampleInputrounded" class="form-label">Invoice Type :</label>&nbsp;&nbsp; <input type="checkbox" name="Invoice_Type">
                                      <label>Actual Invoice</label>
                                    </div>
                                  </div>
                                  <div class="col-xxl-6 col-md-3">
                                    <div>
                                  
                                    </div>
                                  </div>
                               
                                  <div class="col-xxl-6 col-md-6">
                                    <div><p>
                                        <b>Company Name : </b>{{inv_data.company_id}}
                                      </p>
                                      <p>
                                        <b>Owner Name : </b>{{inv_data.company_id.Owner_name}}
                                      </p>
                                      <p>
                                        <b>Address : </b>{{inv_data.company_id.Address}}
                                      </p>
                                      <p>
                                        <b>Email : </b>{{inv_data.company_id.Email_Address}}
                                      </p>
                                      <p>
                                        <b>Phone No : </b>{{inv_data.company_id.Phone_Number}}
                                      </p>
                                      <p>
                                        <b>GST NO. : </b>{{inv_data.company_id.GST_Number}}
                                      </p>
                                      <p>
                                        <b>Office NO. : </b>{{inv_data.company_id.Office_Number}}
                                      </p> 
                                    </div>
                                  </div>
                                  <div class="col-xxl-6 col-md-6">
                                    <div id="viewdealer"></div>
                                  </div>
                                </div>
                                  <style>
                                    table,
                                    th,
                                    td {
                                      border: 1px solid black;
                                    }
                                  </style>
                                  
                                

                                  <div class="container">

                                    <div class="col-xxl-3 col-md-2">
                                      <div class="input-group" >
                                      
                                          <label class="input-group-text" for="inputGroupSelect01" >Select Item </label>
                                          <select class="form-select" name="selecteditem" id="ddlitemmaster" {{inv_data.Item_id.item_name}}   id="inputGroupSelect01">
                                             {% comment %} <option selected="">Choose...</option> {% endcomment %}
                                              {% for i in  allitem %}

                                              <option value='{{i.id}}' >{{i.item_name}}</option>
                                              
                                              {% endfor %}
                                              
                                          </select>
                                          &nbsp;&nbsp;
                                          <input id="addBtn"  class="btn btn-primary" type="button" value="Add"/>
                                      
                                      </div>
                                  </div>
                                  <br>
                                  <br>


                                    {% comment %} <div class="col-xxl-6 col-md-3">
                                      <label><B>select A value to Add new Row </B></label>
                                      <SELECT style="width: 150px;" class="form-control" id="ddlitemmaster" name="selecteditem" >
                                         {% for x in allitem %}
                                          <option value='{{x.id}}'><b>{{x.item_name}}</b> </option>
                                        {% endfor %} 
                                      </SELECT>&nbsp;
                                    </div> {% endcomment %}
                                    <div class="row clearfix">
                                    
                                      <div class="col-md-12">
                                        <table class="table table-bordered table-hover" id="tab_logic">
                                          <thead>
                                            <tr>
                                              <th ># </th>
                                              <th class="text-center"> Item Name </th>
                                              <th class="text-center"> Item Description </th>
                                              <th class="text-center"> Model Name </th>
                                              <th class="text-center"> Ampear </th>
                                              <th class="text-center"> Avilable Qty </th>
                                              <th class="text-center"> Qty </th>
                                              <th class="text-center"> Price </th>
                                              <th class="text-center"> Total </th>
                                              <th class="text-center"> Delete </th>
                                            </tr>
                                          </thead>
                                          <tbody id="tbody" >
                                            {% for i in Items %}
                                            <tr>
                                              <td><input type="hidden" name="id"   value="{{i.Item_id.id}}" class="form-control" /></td>
                                              <td><input type='text' name="Itemname"   value="{{i.Item_id.item_name}}" class="form-control" /></td>
                                              <td><input type='text' name="Itmdes"  value="{{i.Item_id.item_description}}" class="form-control" /></td>
                                              <td><input type='text' name='modelname'  value="{{i.Item_id.model_name}}" class="form-control" /></td>
                                              <td><input type='text' name='ampear'  value="{{i.Item_id.Ampear}}" class="form-control" /></td>
                                              <td><input type='text' name='item_Qty'  value="{{i.Item_id.Quantity}}" class="form-control"  disabled /></td>
                                              <td><input type='number' name='qty[]' placeholder='Enter Qty' value="{{i.Quantity}}" id = 'quantity' onchange='calc()'  class="form-control qty"  min='0' /></td>
                                              <td><input type='text' name='price[]' id='item_price'  value="{{i.Item_id.DP_price}}"  class="form-control price" disabled /></td>
                                              <td><input type='number' name='total[]' value="{{i.Rate}}"  id='total_price' class="form-control total" readonly /></td>
                                              <td align="center"><a  href="{% url 'ItemMaster:Invoice_item_del' pk=i.id %}"><i class="fa fa-trash-o"  aria-hidden="true" style="font-size:24px;color:red"></i></a></td>
                                            </tr>
                                         
                                           {% endfor %}
                                            </tbody>
                                           
                                          </tbody>
                                        </table>
                                      </div>
                                    </div>
                                    <div class="row clearfix">
                                      <div class="col-md-12">
                                        {% comment %} <button id="add_row" class="btn btn-default pull-left">Add Row</button>
                                        <button id='delete_row' class="pull-right btn btn-default">Delete Row</button> {% endcomment %}
                                      </div>
                                    </div>
                                    <div class="row clearfix" style="margin-top:20px;float:right;">
                                      <div class="pull-right col-md-12" width="100%">
                                        <table class="table table-bordered table-hover"  id="tab_logic_total">
                                          <tbody>
                                            <tr>
                                              <th class="text-center">Sub Total</th>
                                              <td class="text-center">
                                                <input type="number" name='sub_total' value={{inv_data.SubTotal}} placeholder='0' class="form-control" id="sub_total" readonly />
                                              </td>
                                            </tr>
                                            <tr>
                                              <th class="text-center">Tax</th>
                                              <td class="text-center">
                                                <div class="input-group mb-2 mb-sm-0">
                                                  <input type="number" value={{inv_data.TotalTax}}   class="form-control" name="tax" id="tax" placeholder="0">
                                                  <div class="input-group-addon">%</div>
                                                </div>
                                              </td>
                                            </tr>
                                            <tr>
                                              <th class="text-center">Tax Amount</th>
                                              <td class="text-center">
                                                <input type="number" name='tax_amount' value={{inv_data.TaxAmount}}  id="tax_amount" placeholder='0' class="form-control" readonly />
                                              </td>
                                            </tr>
                                            <tr>
                                              <th class="text-center">Grand Total</th>
                                              <td class="text-center">
                                                <input type="number" name='total_amount' value={{inv_data.TotalAmount}} id="total_amount"   placeholder='0' class="form-control" readonly />
                                              </td>
                                            </tr>
                                            {% comment %} <tr>
                                              <th class="text-center">Recived Amount</th>
                                              <td class="text-center">
                                                <input type="number" name='recived_amount' id="recived_amount" placeholder='0.00' class="form-control"  />
                                              </td>
                                            </tr>
                                            <tr>
                                              <th class="text-center">Due Amount</th>
                                              <td class="text-center">
                                                <input type="number" name='due_amount' id="due_amount" placeholder='0.00' class="form-control" readonly />
                                              </td>
                                            </tr> {% endcomment %}
                                          </tbody>
                                        </table>
                                      </div>
                                    </div>
                                  </div>
                                  <div>
                                  
                                  </div>
                                </div>
                              </div>
                              <div class="col gy-4"  >
                                <a href="">
                                  <button type="submit" class="btn btn-primary" style="width: 70px;">Save</button>
                                </a>
                                
                                <a href="#">
                                  <button type="submit" class="btn btn-primary" style="width: 90px;">Preview</button>
                              </a>
                              <a href="{% url 'ItemMaster:Invoice_view' %}">
                                <button type="button" class="btn btn-danger" style="width: 90px;">Cancel</button>
                            </a>
                            
                            </div>
                             
                            </div>
                          </div>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

        <script
            src="http://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
            crossorigin="anonymous">
        </script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment-with-locales.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.4/js/select2.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment-with-locales.min.js"></script>

        {% comment %} <script>

          function multiply()
          {
              // Get the input values
              a = Number(document.getElementById('QTY').value);
              b = Number(document.getElementById('PPRICE').value);
              d=  Number(document.getElementById('tax').value);
              // Do the multiplication
              c = a*b;
              e=d/100*c;
              g=c+e;
              // Set the value of the total
              document.getElementById('TOTAL').value=c;
              document.getElementById('sub_total').value=c;
              document.getElementById('tax_amount').value=e;
              document.getElementById('total_amount').value=g;
          }
              
          
       
      </script> {% endcomment %}



      <script>
        $("#dealerinfo").change(function () {
            const dealinfo = $(this).val();  // get the selected subject ID from the HTML dropdown list 
                  console.log(dealinfo)
            $.ajax({                       // initialize an AJAX request
                type: "POST",
                url: '/get_dealer_ajax/',
                data: {
                    'dealer_id': dealinfo,       // add the country id to the POST parameters
                    'csrfmiddlewaretoken':$('input[name=csrfmiddlewaretoken]').val(),
                },
                success: function (response) {   // `data` is from `get_topics_ajax` view function
                   // replace the contents of the topic input with the data that came from the server
                    data=response.dealer_data
                    console.log(data)
                    $("#viewdealer").empty();
                    $("#viewdealer").append();

                    
                        var mainContainer = document.getElementById("viewdealer");
                        console.log(mainContainer);
                        for (var i = 0; i < data.length; i++) {
                          var div = document.createElement("div");
                        
                          console.log(data[0].id);
                          div.innerHTML = "<b>" + 'Dealer Company Name  : '+ "</b>"   + data[0].dealer_company_name + "<br/>" + "<br/>" 
                      
                                        +"<b>" + 'Dealer Name :    ' + "</b>" + data[i].dealre_name + "<br/>" + "<br/>" 
                                        +"<b>" + 'Dealer Address : ' +"</b>" + data[i].dealer_address + "<br/>" + "<br/>" 
                                        +"<b>" + 'Dealer Email :   ' +"</b>" + data[i].dealer_email_address  + "<br/>"+ "<br/>" 
                                        +"<b>" + 'Dealer Mobile NO. :  ' +"</b>" + data[i].dealer_phone_number + "<br/>"+ "<br/>" 
                                        +"<b>" + 'Dealer GST Number :  ' +"</b>" + data[i].gst_number+ "<br/>"+ "<br/>" 
                                        +"<b>" + 'Dealer Office NO. :  ' +"</b>" + data[i].dealer_office_number;


                          mainContainer.appendChild(div);
                        }
                      

                }
                            
          
            });
        });
    
    </script>

        <script>
            $('#date').val(new Date().toJSON().slice(0,10));
        </script>

        <script>
            $("#ddlitemmaster").change(function () {
                output="";
                const itemId= $(this).val();  // get the selected subject ID from the HTML dropdown list 
                
                $.ajax({                       // initialize an AJAX request
                    method: "POST",
                    url: '/get_items_ajax/',
                    data: {
                        'item_id': itemId,       // add the country id to the POST parameters
                        'csrfmiddlewaretoken':$('input[name=csrfmiddlewaretoken]').val(),
                    },
                              success: function (response) {   // `data` is from `get_topics_ajax` view function
                                // replace the contents of the topic input with the data that came from the server
                                
                                  x=response.item_data
                                
                                
                                  for (i = 0; i<x.length; i++) {
                                  
                                      output+="<tr><td><input type='hidden' name='id'   value='"+x[i].id+"' class='form-control />'+'</td><td><input type='text' name='Itemname'   value='"+x[i].item_name+"' class='form-control />'+'</td><td><input type='text' name='Itmdes'  value='"+x[i].item_description+"' class='form-control />'+'</td><td><input type='text' name='modelname'  value='"+x[i].model_name+"' class='form-control />'+'</td><td><input type='text' name='ampear'  value='"+x[i].Ampear+"' class='form-control />'+'</td><td><input type='text' name='item_Qty'  value="+x[i].Quantity+" class='form-control  disabled />'+'</td><td><input type='number' name='qty[]' placeholder='Enter Qty' value='1' id = 'quantity' onchange='calc()'  class='form-control qty'  min='0' /></td><td><input type='text' name='price[]' id='item_price'  value="+x[i].DP_price+"  class='form-control price' disabled /></td><td><input type='number' name='total[]'  value="+x[i].DP_price+" id='total_price' class='form-control total' readonly /></td><td align='center'><i class='fa fa-trash-o'  onclick='deleteRow(this)' aria-hidden='true' style='font-size:24px;color:red'></i></td> </tr>";
                                      additem();
                                  }
                                
                              
                                }
                            });
                        });
        </script>
        <script>
          function additem(){
              //var rowCount = $('#tab_logic  tr').length;
              //console.log(rowCount);
              // jQuery button click event to add a row
              $('#addBtn').on('click', function () {
                  $('#tbody').append(output);
                  calc();
                 // console.log(output)
                // Adding a row inside the tbody.
              
              });

              $("#addBtn").on('click', function(){
                name = $(this).text();
                console.log(name);
                if($("#" + name).length == 0) {
                  $("div#chatbar").append("<div class='labels'><div id='" + name + "' style='display:none;'></div>" + name + "</div>");
                } else {
                  alert('this record already exists');
                }
              });
         
          }
         
        </script>

        <script>
          function deleteRow(r) {
            var i = r.parentNode.parentNode.rowIndex;
            document.getElementById("tab_logic").deleteRow(i);
            calc();
            calc_total();
          }
          </script>

        {% comment %} <script>
            function yourfunction(radioid)
        {
        if(radioid == 0)
        {
            document.getElementById('one').style.display = '';
            document.getElementById('two').style.display = 'none'; 
        }
        else if(radioid == 1)
        {    
            document.getElementById('one').style.display = '';
            document.getElementById('two').style.display = 'none';

        }
        else if(radioid == 2)
        {  
            
            document.getElementById('two').style.display = '';
            document.getElementById('one').style.display = 'none';
        }

        }
        </script> {% endcomment %}

        {% comment %} <script>

           // delete data : 
    $("tbody").on('click',".btn-del",function(){
      output="";
      console.log("del button clicked");
      let id=$(this).attr('data-sid');
      let csr = $("input[name=csrfmiddlewaretoken]").val();
      console.log(id);
      mydata={
          id:id,
          csrfmiddlewaretoken: csr,
      }
      $.ajax(
          {
              url: '/del_user/',
              method: "POST",
              data: mydata,
              success: function (response) {
                  //console.log("---> response", response.context.data);
                  x = response.data; // getting all data from response
                  
                  //console.log("--------------->data",response.context.udata);
                  for (i = 0; i < x.length; i++) {
                    output+="<tr><td><input type='text' name='Itemname'  value='"+x[i].item_name+"' class='form-control />'+'</td><td><input type='text' name='Itmdes'  value='"+x[i].item_description+"' class='form-control />'+'</td><td><input type='text' name='Itemname'  value='"+x[i].model_name+"' class='form-control />'+'</td><td><input type='text' name='Itemname'  value='"+x[i].Ampear+"' class='form-control />'+'</td><td><input type='text' name='Itemname'  value="+x[i].Quantity+" class='form-control  readonly />'+'</td><td><input type='number' name='qty[]' placeholder='Enter Qty' id = 'quantity' onchange='calc()'  class='form-control qty' step='0' min='0' /></td><td><input type='text' name='price[]' id='item_price'  value="+x[i].DP_price+"  class='form-control price' disabled /></td><td><input type='number' name='total[]' placeholder='0.00' id='total_price' class='form-control total' readonly /></td>'+'<td><input type='button' class='btn btn-warning btn-sm btn-del' value='Delete' data-sid="+x[i].id+" /> </td> </tr>";
                  }
                  $("#tbody").html(output);
                  //$("form")[0].reset();
                 
              }
          },
      );
 
  });

        </script> {% endcomment %}


        {% comment %} <script>
            $(document).ready(function(){
        
                // Initialize select2
                $("#12").select2();
            
                // Read selected option
            
            });
            $(document).ready(function(){
        
                // Initialize select2
                $("#23").select2();
            
                // Read selected option
            
            });
            
        </script> {% endcomment %}
        {% comment %} <script>
          
            $('#quantity').keyup(function() {
              var quantity = $("#quantity").val();
              var iPrice = $("#item_price").val();
              console.log(quantity)
              console.log(iPrice)
           
              var total = quantity * iPrice;
              console.log(total)
           
              $("#total_price").val(total); // sets the total price input to the quantity * price
           });
        
        
        
      </script> {% endcomment %}

   <script> 
      $(document).ready(function(){
        var i=1;
        $("#add_row").click(function(){b=i-1;
            $('#addr'+i).html($('#addr'+b).html()).find('td:first-child').html(i+1);
            $('#tab_logic').append('<tr id="addr'+(i+1)+'"></tr>');
            i++; 
        });
        $("#delete_row").click(function(){
          if(i>1){
        $("#addr"+(i-1)).html('');
        i--;
        }
        calc();
      });
      
      $('#tab_logic tbody').on('keyup change',function(){
        calc();
      });
      $('#tax').on('keyup change',function(){
        calc_total();
      });
      
    
    });
    
    
    function calc()
    {
      $('#tab_logic tbody tr').each(function(i, element) {
        var html = $(this).html();
       // console.log(html)
        if(html!='')
        {
          var qty = $(this).find('.qty').val();
          //console.log(qty)
          var price = $(this).find('.price').val();
          //console.log(price)
          $(this).find('.total').val(qty*price);
       
          
          calc_total();
         
        }
        });
    }
    
    function calc_total()
    {
      total=0;
      $('.total').each(function() {
            total += parseInt($(this).val());
           
        });
       // console.log(total)
      $('#sub_total').val(total);
      tax_sum=total/100*$('#tax').val();
      $('#tax_amount').val(tax_sum);
      $('#total_amount').val((tax_sum+total));
      //total_amount=tax_sum+total;
      //recived_amount=total_amount-$('#recived_amount').val();
      //console.log(recived_amount);
    }

    </script>

    <script>
      $('#total_price').each(function() {
        var amount = $(this).find('.total').val();
        console.log(amount)
    });
    </script>
   

{% endblock %}